{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://2book.example.com/schemas/chunks.json",
  "title": "ChunkCollection",
  "description": "Output schema for the book content ingestion pipeline",
  "type": "object",
  "required": ["chunks"],
  "properties": {
    "chunks": {
      "type": "array",
      "description": "Array of all text chunks from processed documents",
      "items": {
        "$ref": "#/definitions/Chunk"
      },
      "minItems": 1
    },
    "metadata": {
      "$ref": "#/definitions/Metadata"
    }
  },
  "definitions": {
    "Chunk": {
      "type": "object",
      "description": "A segment of clean text from a document",
      "required": ["chunk_id", "text", "source_path", "slug", "title", "order_index"],
      "properties": {
        "chunk_id": {
          "type": "string",
          "description": "Stable unique identifier in format doc-NNN-NNNN",
          "pattern": "^doc-[0-9]{3}-[0-9]{4}$",
          "examples": ["doc-001-0001", "doc-002-0003"]
        },
        "text": {
          "type": "string",
          "description": "Clean, readable prose content without markdown syntax",
          "minLength": 1
        },
        "source_path": {
          "type": "string",
          "description": "Relative path to source markdown file",
          "pattern": "^docs/.*\\.md$",
          "examples": ["docs/chapter-1/index.md", "docs/intro.md"]
        },
        "slug": {
          "type": "string",
          "description": "URL-friendly document identifier",
          "pattern": "^[a-z0-9-]+$",
          "examples": ["chapter-1-index", "intro"]
        },
        "title": {
          "type": "string",
          "description": "Document title from frontmatter or derived from filename",
          "minLength": 1
        },
        "order_index": {
          "type": "integer",
          "description": "1-based position of chunk within its source document",
          "minimum": 1
        }
      },
      "additionalProperties": false
    },
    "Metadata": {
      "type": "object",
      "description": "Optional pipeline execution metadata",
      "properties": {
        "generated_at": {
          "type": "string",
          "description": "ISO 8601 timestamp of generation",
          "format": "date-time"
        },
        "total_documents": {
          "type": "integer",
          "description": "Number of documents processed",
          "minimum": 0
        },
        "total_chunks": {
          "type": "integer",
          "description": "Number of chunks created",
          "minimum": 0
        },
        "version": {
          "type": "string",
          "description": "Pipeline version string",
          "examples": ["1.0.0"]
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
